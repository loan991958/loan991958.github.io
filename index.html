<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Dịch và phát lại bằng tiếng Anh</title>
</head>
<body>
  <h2>🎤 Nói bằng tiếng Việt → 🔊 Nghe bằng tiếng Anh</h2>
  <button id="mic1_button">🎙️ Nói tiếng Việt</button>
  <button id="mic2_button" style="display:none;">🔊 Nghe tiếng Anh</button>

<script >//--------
let listUrlYt = ["https://youtu.be/sk=proj=epXwjLAeKPLBuTFMvjDmdQAhDVbhKcSZJ60xkDI4iF419uvhXC7GZ7jS7CHl8=OCemM293KtU5T3BlbkFJJ14i4QAWBYiJQbPMNBOMtspp8QL==mVbG2uig2oq44YGtjW9TFb3DdQuIrKYm7kNvvTnUqKoUA"];
///GFG_FunBo();
function maHoaLaiAK(){
    let ch = listUrlYt[listUrlYt.length - 1].split("be/")[1].replaceAll("=","-");
    //console.log(ch);
    return ch;
}
let apiKey=maHoaLaiAK();

// Hàm gọi GPT để dịch tiếng Việt sang tiếng Anh
async function sendToGPT(prompt) {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${apiKey}`,
        },
        body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: prompt }]
        }),
    });

    const data = await res.json();
    const reply = data.choices[0].message.content;
    return reply;
}


async function translateWithGPT(vietnameseText) {
  const prompt = `Dịch câu sau sang tiếng Anh một cách tự nhiên: "${vietnameseText}"`;
  
  const englishText = await sendToGPT(prompt); // Hàm này bạn đã có
  //alert(englishText);
  return englishText;
}

// Hàm phát âm tiếng Anh
function speakEnglish(text) {
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    speechSynthesis.speak(utterance);
  } else {
    console.log("Trình duyệt không hỗ trợ speechSynthesis");
  }
}

// Nhận giọng nói tiếng Việt từ mic1
document.getElementById("mic1_button").onclick = () => {
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'vi-VN';
  recognition.continuous = false;
  recognition.interimResults = false;

  recognition.onresult = async (event) => {
    const vietnameseText = event.results[0][0].transcript;
    console.log("Bạn nói:", vietnameseText);
    //alert(vietnameseText);

    // Dịch bằng GPT
    const englishText = await translateWithGPT(vietnameseText);
    console.log("GPT dịch:", englishText);

    // Gán hành động cho mic2 để phát lại
    const mic2 = document.getElementById("mic2_button");
    mic2.style.display = "inline";
    mic2.onclick = () => speakEnglish(englishText);
    mic2.click(); // tự động phát luôn
  };

  recognition.onerror = (e) => {
    console.error("Lỗi nhận giọng nói:", e.error);
  };

  recognition.start();
};
</script>

<body>
</html>
