<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Let's learn English with Tactics For Listening</title>

<style>
body{
    background:lightgray;
    /*background-color: darkgray;*/}
.video-wrapper {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;}
.video-wrapper iframe {
    position: absolute;
    top:0;
    left: 0;
    width: 100%;
    height: 100%;}
.unit_chons{text-align: center;}  
h1{text-align: center; color: green;}  
.about{text-align:center;height:50px;width:50px;border-radius: 50%;border:none;color:white ;background: darkgray;margin-left: 45%;}
h2{text-align: center; color: green;}  
.wrapper {
    display: grid;
    gap: 4px;
    width: 100%;
    max-width: calc(100vw - 0px);
    padding: 0x;
    font-size: 16px;
    border-radius: 0px;
    background-color: darkgreen;
}
.alignL { text-align: left; color:lightgreen;}
.alignC { text-align: center; color:pink;}
.alignR { text-align: right; color:orange;}
#output{color: whitesmoke;}
#outputgpt{color: yellow;}
#start-btn{width:84px; height: 84px; border-radius: 50%;background-color: whitesmoke;}
#stop-btn{width:84px; height: 84px; border-radius: 50%;background-color: whitesmoke;}



</style>    
</head>
<body>

    <h1>Let's learn English with "Tactics for Listening"</h1>
    <div class="unit_chons">
    <select id="unit_chon" onchange="chonUnit()">
        <option value="">--Select a Unit--</option>
    </select>
    </div><br>
    <!-- Dat khung video yt o day . Khi chon unit thi chay ham embed_apiyt()-->
    <div class="video-wrapper">
        <iframe id="iframe_yt" src="" >
        </iframe>
    </div><br>
    
    <button style="background-color:Gold;text-align:left;width:75%;">
        <a href="https://online.flipbuilder.com/sdtta/fpva/mobile/index.html">
        BASIC Tactics For Listening 3-nd Edition PDF</a>
    </button>
    <br>
    <button style="background-color:lightgreen;text-align:center;width:75%;margin-left: 10%;">
        <a href="https://online.flipbuilder.com/sdtta/kjol/">
        DEVELOPING Tactics For Listening 3-nd Edition PDF</a>
    </button>
    <br>
    <button style="background-color:lightblue;text-align:right;width:75%;float:right;margin-left: 20%;">
        <a href="https://online.flipbuilder.com/sdtta/vlyh/">
        EXPANDING Tactics For Listening 3-nd Edition PDF</a>
    </button>
    <br><br>
    <h2>Let's practice to talk in English with GPT</h2>
    <button class="wrapper" >
        <table >
          <tr> 
            <td class="alignL"><button id="start-btn">User<img id="start_img" src="icons/mic.gif" alt="Start"></button></td>
            <td id="output"></td>
            <td class="alignR"><button id="stop-btn" disabled><img id="answer_img" src="icons/bot.jpg" alt="Answer">Gpt</button></td>
          </tr> 
          <tr> 
            <td>...</td>
            <td id="outputgpt"></td>
            <td>...</td>
          </tr> 

        </table>
    </button>
    <br><br>
    <button class="about" onclick="aboutapp()">About</button>
    <!-- ------------------------------------------------ -->
    

    <script>//Ma duoi day bat buoc phai dat o html, neu dat trong tep js ben ngoai (hoc_en_tactics) se khong chay
        let id = "Xj8Amv0Z52w";
        const selectb = document.getElementById("unit_chon");
        var videoIDcurrent="Xj8Amv0Z52w"; //nen la id luu last
        document.getElementById("iframe_yt").src="https://youtube.com/embed/" + videoIDcurrent;
        //------------------
        function chonUnit(){ //chon unit khac va update iframe
            videoIDcurrent = list_id[selectb.selectedIndex];
            //alert(videoIDcurrent); src embed co dang do yt quy dinh : "https://youtube.com/embed/"+id_yt
            document.getElementById("iframe_yt").src="https://youtube.com/embed/" + videoIDcurrent;
        }
        //----------
        function aboutapp(){
            var dong1 = "- B·ªô s√°ch 'Tactics for l√≠stening' c·ªßa Jack C. Richards do ƒê·∫°i h·ªçc Oxford ph√°t h√†nh l·∫ßn th·ª© 3 ƒë∆∞·ª£c r·∫•t nhi√™u ng∆∞·ªùi d√πng.\n";
            var dong2 = "- tiensg89@gmail.com t√¨m th·∫•y tr√™n m·∫°ng n√™n g√≥p nh·∫∑t t·∫£i v·ªÅ v√† l·∫≠p trang web n√†y ƒë·ªÉ thu·∫≠n ti·ªán s·ª≠ d·ª•ng v√† gi√∫p ng∆∞·ªùi kh√°c trong vi·ªác t·ª± h·ªçc nghe ti·∫øng Anh.\n";
            var dong3 = "- N√≥ c√≥ 3 cu·ªën, m·ªói cu·ªën c√≥ 24 unit k√®m theo audio ƒë·ªÉ nghe. S√°ch c√≥ d·∫°ng 'pdf flip' r·∫•t hay.\n";
            var dong4 = "- C√°ch s·ª≠ d·ª•ng ƒë·ªÉ h·ªçc l√† do ng∆∞·ªùi d√πng t·ª± kh√°m ph√° v√† ho·∫°ch ƒë·ªãnh. B·ªô t√†i li·ªáu n·∫£y r·∫•t tuy·ªát.";
            alert(dong1+dong2+dong3+dong4);
        }
    </script>
<script>
//chatGPT
const startBtn = document.getElementById('start-btn');
const stopBtn = document.getElementById('stop-btn');
const output = document.getElementById('output');

let recognition;

if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition(); // For Chrome
} else if ('SpeechRecognition' in window) {
  recognition = new SpeechRecognition(); // Other browsers
} else {
  alert("Your browser does not support Speech Recognition.");
}

if (recognition) {
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = "en-US";

  recognition.onstart = () => {
    //output.textContent = "Listening...";
    output.textContent = "";
    outputgpt.textContent = "";
    startBtn.disabled = true;
    stopBtn.disabled = false;
  };

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    output.textContent = "üìù " + transcript;
    sendMessage(transcript);
  };

  recognition.onerror = (event) => {
    console.error("Speech recognition error:", event.error);
    output.textContent = "‚ùå Error: " + event.error;
  };

  recognition.onend = () => {
    startBtn.disabled = false;
    stopBtn.disabled = true;
  };

  startBtn.addEventListener('click', () => {
    recognition.start();
  });

  stopBtn.addEventListener('click', () => {
    recognition.stop();
  });
}

</script>    

<script>

//  <input type="text" id="userInput" placeholder="Nh·∫≠p tin nh·∫Øn c·ªßa b·∫°n...">
//<button onclick="sendMessage()">G·ª≠i</button>

//const apiKey = "YOUR_OPENAI_API_KEY"; // Thay b·∫±ng API Key c·ªßa b·∫°n
const apiKey = "";

async function sendMessage(transcript) {
  let userInput = transcript;
  //alert(userInput);
  if (!userInput) return;

  //let chatbox = document.getElementById("chatbox");
  //chatbox.innerHTML += `<p><strong>B·∫°n:</strong> ${userInput}</p>`;

  // G·ª≠i tin nh·∫Øn ƒë·∫øn OpenAI API
  let response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${apiKey}`
    },
    body: JSON.stringify({
      model: "gpt-4o-mini",
      messages: [{ role: "user", content: userInput }]
    })
  });

  let data = await response.json();
  let reply = data.choices[0].message.content;
  outputgpt.textContent = reply;
  
  function speakText(text) {
    let utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    speechSynthesis.speak(utterance);
  }
  speakText(reply);

  //chatbox.innerHTML += `<p><strong>ChatGPT:</strong> ${reply}</p>`;
  //document.getElementById("userInput").value = "";
  //chatbox.scrollTop = chatbox.scrollHeight;
}

</script>

<script src="index.js"></script>

</body>
</html>
