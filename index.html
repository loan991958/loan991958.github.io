<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
<style>
body {
    background-image: linear-gradient(30deg, #1666b0, #fbfafb); 
    color: #fff;
    font: 1rem/1 'Poppins', sans-serif;
    height:100%;
    padding: 20px;
    max-width: 700px; 
    margin: auto;
}

h2 { text-align: center; color:darkblue}
#chatbox { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-bottom: 10px; }

.menu-group {
  display: flex;
  justify-content: space-between;
  padding: 0 10%; /* cÃ¡ch biÃªn trÃ¡i vÃ  pháº£i 20px */
  width: 100%;
  box-sizing: border-box;
}


.menu-group select {
  width: 30%; /* hoáº·c tuá»³ chá»‰nh theo nhu cáº§u */
  padding: 8px;
  font-size: 16px;
  background-color: transparent;
}
.button-group {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%; /* hoáº·c Ä‘áº·t chiá»u rá»™ng cá»¥ thá»ƒ */
  padding: 10px 0px; /* tuá»³ chá»‰nh khoáº£ng cÃ¡ch lá» */
}
#mic1_button {
    width: 60px; /* KÃ­ch thÆ°á»›c nÃºt */
    height: 60px;
    border-radius: 50%; /* LÃ m cho nÃºt trÃ²n */
    /*background-image: url("icons/mic1-animation.gif");  áº¢nh bÃªn trong */
    background-image:  "url('')"; /* áº¢nh bÃªn trong */
    background-size: cover; /* Äáº£m báº£o áº£nh phá»§ Ä‘áº§y */
    background-position: center;
    border: 3px solid #333; /* Viá»n */
    cursor: pointer;
    align-items: center;
    justify-content: center;
}
#mic2_button {
    width: 60px; /* KÃ­ch thÆ°á»›c nÃºt */
    height: 60px;
    border-radius: 50%; /* LÃ m cho nÃºt trÃ²n */
    /*background-image: url("icons/mic1-animation.gif");  áº¢nh bÃªn trong */
    background-image:  "url('')"; /* áº¢nh bÃªn trong */
    background-size: cover; /* Äáº£m báº£o áº£nh phá»§ Ä‘áº§y */
    background-position: center;
    border: 3px solid #333; /* Viá»n */
    cursor: pointer;
    align-items: center;
    justify-content: center;
}


#loa_button {
  padding: 10px 20px;
  font-size: 16px;
  width: 50px;
  height: 50px;
  border: 2px solid #ccc;
  background-image: url("icons/loa.png");
  background-size: cover;
  background-position: center;
  cursor: pointer;
  align-items: center;
  justify-content: center;
}

</style>

</head>
<body>
<h2 >ğŸ—£ï¸Talk With ForeignersğŸ‘¤</h2>

<div id="chatbox"></div>

<div class="menu-group">
    <select id="lang-left" onclick="toggleMenuL()" ></select>
    <select id="lang-right" onclick="toggleMenuR()" ></select>
</div>

<div class="button-group">
    <button id="mic1_button" >ğŸ¤</button>
    <button id="loa_button" ></button>
    <button id="mic2_button" >ğŸ™ï¸</button>
</div>

<br><br><br><br><br><br><br><br><br><br>


<script>
const mic1_button = document.getElementById("mic1_button");
const mic2_button = document.getElementById("mic2_button");  
const loa_button = document.getElementById("loa_button");


let listUrlYt = ["https://youtu.be/sk=proj=epXwjLAeKPLBuTFMvjDmdQAhDVbhKcSZJ60xkDI4iF419uvhXC7GZ7jS7CHl8=OCemM293KtU5T3BlbkFJJ14i4QAWBYiJQbPMNBOMtspp8QL==mVbG2uig2oq44YGtjW9TFb3DdQuIrKYm7kNvvTnUqKoUA"];
///GFG_FunBo();
function maHoaLaiAK(){
    let ch = listUrlYt[listUrlYt.length - 1].split("be/")[1].replaceAll("=","-");
    //console.log(ch);
    return ch;
}
let apiKey=maHoaLaiAK();

// HÃ m gá»i GPT Ä‘á»ƒ dá»‹ch tiáº¿ng Viá»‡t sang tiáº¿ng Anh
async function sendToGPT(prompt) {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${apiKey}`,
        },
        body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: prompt }]
        }),
    });

    const data = await res.json();
    const reply = data.choices[0].message.content;
    return reply;
}


async function translateWithGPT(vietnameseText) {
  const prompt = `"${vietnameseText}". Dá»‹ch cÃ¢u trÃªn sang tiáº¿ng Anh má»™t cÃ¡ch tá»± nhiÃªn mÃ  khÃ´ng cáº§n giáº£i thÃ­ch.`;
  
  const englishText = await sendToGPT(prompt); // HÃ m nÃ y báº¡n Ä‘Ã£ cÃ³
  //alert(englishText);
  return englishText;
}

// HÃ m phÃ¡t Ã¢m tiáº¿ng Anh
function speakEnglish(text) {
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.onend = () => loa_button.style.backgroundImage = "url('icons/loa.png')";
    speechSynthesis.speak(utterance);
    loa_button.style.backgroundImage = "url('icons/loa-animation.gif')";
  } else {
    console.log("TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ speechSynthesis");
  }
};
// Nháº­n giá»ng nÃ³i tiáº¿ng Viá»‡t tá»« mic1
mic1_button.onclick = () => {

    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'vi-VN';
    recognition.continuous = false;//
    recognition.interimResults = false;// Chá»‰ láº¥y káº¿t quáº£ cuá»‘i cÃ¹ng


    recognition.onresult = async (event) => {
        const vietnameseText = event.results[0][0].transcript;
        console.log("Báº¡n nÃ³i:", vietnameseText);
        recognition.stop();// Dá»«ng nháº­n giá»ng nÃ³i khi káº¿t thÃºc 

        //alert(vietnameseText);

        // Dá»‹ch báº±ng GPT
        const englishText = await translateWithGPT(vietnameseText);
        console.log("GPT dá»‹ch:", englishText);

        // GÃ¡n hÃ nh Ä‘á»™ng cho loa_button Ä‘á»ƒ phÃ¡t láº¡i
        loa_button.onclick = () => speakEnglish(englishText);
        loa_button.click(); // tá»± Ä‘á»™ng phÃ¡t luÃ´n
    };

    recognition.onerror = (e) => {
        console.error("Lá»—i nháº­n giá»ng nÃ³i:", e.error);
    };
    recognition.onend = () => {
      mic1_button.style.backgroundImage = "none";
    };
    recognition.onstart = function() {// Ä‘ang nháº­n giá»ng nÃ³i sau khi báº¥m mic1
      mic1_button.style.backgroundImage = "url('icons/mic1-animation.gif')"; 
    };

    recognition.start();// Báº¯t Ä‘áº§u nháº­n giá»ng nÃ³i
};

</script>    
</body>
</html>
