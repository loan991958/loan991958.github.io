<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversation in 2 languages</title>
<style>
body {
    background-image: linear-gradient(30deg, #1666b0, #fbfafb); 
    color: #fff;
    font: 1rem/1 'Poppins', sans-serif;
    height:100%;
    padding: 20px;
    max-width: 700px; 
    margin: auto;
}

h2 { text-align: center; color:darkblue}

#chatbox { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll; margin-bottom: 10px; }

.menu-group {
  display: flex;
  justify-content: space-between;
  padding: 0 10%; /* c√°ch bi√™n tr√°i v√† ph·∫£i 20px */
  width: 100%;
  box-sizing: border-box;
}


.menu-group select {
  width: 30%; /* ho·∫∑c tu·ª≥ ch·ªânh theo nhu c·∫ßu */
  padding: 8px;
  font-size: 16px;
  background-color: transparent;
}
.button-group {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%; /* ho·∫∑c ƒë·∫∑t chi·ªÅu r·ªông c·ª• th·ªÉ */
  padding: 10px 0px; /* tu·ª≥ ch·ªânh kho·∫£ng c√°ch l·ªÅ */
}
#mic1_button {
    width: 70px; /* K√≠ch th∆∞·ªõc n√∫t */
    height: 70px;
    border-radius: 50%; /* L√†m cho n√∫t tr√≤n */
    /*background-image: url("icons/mic1-animation.gif");  ·∫¢nh b√™n trong */
    background-image:  "url('')"; /* ·∫¢nh b√™n trong */
    background-size: cover; /* ƒê·∫£m b·∫£o ·∫£nh ph·ªß ƒë·∫ßy */
    background-position: center;
    border: 3px solid #333; /* Vi·ªÅn */
    cursor: pointer;
    align-items: center;
    justify-content: center;
}
#mic2_button {
    width: 70px; /* K√≠ch th∆∞·ªõc n√∫t */
    height: 70px;
    border-radius: 50%; /* L√†m cho n√∫t tr√≤n */
    /*background-image: url("icons/mic1-animation.gif");  ·∫¢nh b√™n trong */
    background-image:  "url('')"; /* ·∫¢nh b√™n trong */
    background-size: cover; /* ƒê·∫£m b·∫£o ·∫£nh ph·ªß ƒë·∫ßy */
    background-position: center;
    border: 3px solid #333; /* Vi·ªÅn */
    cursor: pointer;
    align-items: center;
    justify-content: center;
}
#start_button {
    width: 30px; /* K√≠ch th∆∞·ªõc n√∫t */
    height: 30px;
    border-radius: 50%; /* L√†m cho n√∫t tr√≤n */
    font-size: 16px;
    /*background-image: url("icons/started.png");  ·∫¢nh b√™n trong */
    background-image:  url('icons/start.png'); /* ·∫¢nh b√™n trong */
    background-size: cover; /* ƒê·∫£m b·∫£o ·∫£nh ph·ªß ƒë·∫ßy */
    background-position: center;
    border: none; /* Vi·ªÅn */
    cursor: pointer;
    align-items: center;
    justify-content: center;
}


#loa_button {
  padding: 10px 20px;
  font-size: 16px;
  width: 50px;
  height: 50px;
  border: 2px solid #ccc;
  background-image: url("icons/loa.png");
  background-size: cover;
  background-position: center;
  cursor: pointer;
  align-items: center;
  justify-content: center;
}
.mic1-vi {
    color: rgb(226, 218, 218);
}
.mic1-en {
    color: darkgreen;
    font-size: xx-large;
}


</style>

</head>
<body>
<h2 >Conversation in 2 languages</h2>
<h2 >üó£Ô∏è<button id="start_button"></button>üë§</h2>


<div id="chatbox"></div>
<br>
<div class="menu-group">
    <select id="lang-left" onclick="toggleMenuL()" ></select>
    <select id="lang-right" onclick="toggleMenuR()" ></select>
</div>

<div class="button-group">
    <button id="mic1_button" >üé§</button>
    <button id="loa_button" ></button>
    <button id="mic2_button" >üéôÔ∏è</button>
</div>



<script>
const start_button = document.getElementById("start_button");
const chatbox = document.getElementById("chatbox");
const mic1_button = document.getElementById("mic1_button");
const mic2_button = document.getElementById("mic2_button");  
const loa_button = document.getElementById("loa_button");


let listUrlYt = ["https://youtu.be/sk=proj=epXwjLAeKPLBuTFMvjDmdQAhDVbhKcSZJ60xkDI4iF419uvhXC7GZ7jS7CHl8=OCemM293KtU5T3BlbkFJJ14i4QAWBYiJQbPMNBOMtspp8QL==mVbG2uig2oq44YGtjW9TFb3DdQuIrKYm7kNvvTnUqKoUA"];
///GFG_FunBo();
function maHoaLaiAK(){
    let ch = listUrlYt[listUrlYt.length - 1].split("be/")[1].replaceAll("=","-");
    //console.log(ch);
    return ch;
}
let apiKey=maHoaLaiAK();

function addMessage(role, text) {
    text = text.replace(/^"(.*)"$/, '$1');// b·ªè d·∫•u ngo·∫∑c k√©p ·ªü ƒë·∫ßu v√† cu·ªëi n·∫øu c√≥
    const div = document.createElement("div");
    //div.innerHTML = `<span class='${role}'>${text}</span> <br>`;
    div.innerHTML = `<span class="${role}">${role === "mic1-vi" ? "<br>" : ""} ${text}</span>`;

    chatbox.appendChild(div);
    chatbox.scrollTop = chatbox.scrollHeight;
}


// H√†m g·ªçi GPT ƒë·ªÉ d·ªãch ti·∫øng Vi·ªát sang ti·∫øng Anh
async function sendToGPT(prompt) {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${apiKey}`,
        },
        body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: prompt }]
        }),
    });

    const data = await res.json();
    const reply = data.choices[0].message.content;
    return reply;
}


async function translateWithGPT(vietnameseText) {
  const prompt = `"${vietnameseText}". D·ªãch c√¢u tr√™n sang ti·∫øng Anh m·ªôt c√°ch t·ª± nhi√™n m√† kh√¥ng c·∫ßn gi·∫£i th√≠ch.`;
  
  const englishText = await sendToGPT(prompt); // H√†m n√†y b·∫°n ƒë√£ c√≥
  //alert(englishText);
  return englishText;
}

// H√†m ph√°t √¢m ti·∫øng Anh
function speakEnglish(text) {
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.onend = () => loa_button.style.backgroundImage = "url('icons/loa.png')";
    speechSynthesis.speak(utterance);
    loa_button.style.backgroundImage = "url('icons/loa-animation.gif')";
  } else {
    console.log("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ speechSynthesis");
  }
};
// Nh·∫≠n gi·ªçng n√≥i ti·∫øng Vi·ªát t·ª´ mic1
mic1_button.onclick = () => {

    const recognition1 = new webkitSpeechRecognition();
    recognition1.lang = 'vi-VN';
    recognition1.continuous = false;//
    recognition1.interimResults = false;// Ch·ªâ l·∫•y k·∫øt qu·∫£ cu·ªëi c√πng


    recognition1.onresult = async (event) => {
        const vietnameseText = event.results[0][0].transcript;
        console.log("B·∫°n n√≥i:", vietnameseText);
        addMessage("mic1-vi", vietnameseText);

        recognition1.stop();// D·ª´ng nh·∫≠n gi·ªçng n√≥i khi k·∫øt th√∫c 
        //dat o cho nay thi mic ios moi bien mat
        //alert(vietnameseText);

        // D·ªãch b·∫±ng GPT
        const englishText = await translateWithGPT(vietnameseText);
        console.log("GPT d·ªãch:", englishText);
        addMessage("mic1-en", englishText);

        // G√°n h√†nh ƒë·ªông cho loa_button ƒë·ªÉ ph√°t l·∫°i
        loa_button.onclick = () => speakEnglish(englishText);
        loa_button.click(); // t·ª± ƒë·ªông ph√°t lu√¥n
    };

    recognition1.onerror = (e) => {
        console.error("L·ªói nh·∫≠n gi·ªçng n√≥i:", e.error);
    };
    recognition1.onend = () => {
      mic1_button.style.backgroundImage = "none";
    };
    recognition1.onstart = function() {// ƒëang nh·∫≠n gi·ªçng n√≥i sau khi b·∫•m mic1
      mic1_button.style.backgroundImage = "url('icons/mic1-animation.gif')"; 
    };

    recognition1.start();// B·∫Øt ƒë·∫ßu nh·∫≠n gi·ªçng n√≥i
};
start_button.onclick=()=>{
  const recognition = new webkitSpeechRecognition();// Kh·ªüi t·∫°o ƒë·ªëi t∆∞·ª£ng nh·∫≠n gi·ªçng n√≥i de mo mic trong ios
  loa_button.onclick = () => speakEnglish("Let's get started!");
  loa_button.click(); // t·ª± ƒë·ªông ph√°t lu√¥n
  start_button.style.backgroundImage = "url('icons/started.png')";
  start_button.disabled = true;
}
</script>    
</body>
</html>
